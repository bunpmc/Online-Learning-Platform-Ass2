@page
@model OnlineLearningPlatformAss2.RazorWebApp.Pages.User.LoginModel

@{
    ViewData["Title"] = "Sign in to LearnHub";
}

@section Styles {
    <link rel="stylesheet" href="~/css/auth.css" asp-append-version="true" />
}

<div class="auth-page">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-6 col-lg-5">
                <div class="auth-card">
                    <!-- Header -->
                    <div class="auth-header text-center">
                        <a asp-page="/Index" class="auth-logo mb-4 text-decoration-none">
                            <i class="bi bi-mortarboard-fill"></i>
                            <span>LearnHub</span>
                        </a>
                        <h1 class="auth-title">Welcome back</h1>
                        <p class="auth-subtitle mb-2">Sign in to continue your learning journey</p>
                        <a asp-page="/Index" class="text-muted small d-block mb-4">Continue as Guest</a>
                    </div>

                    <!-- Alerts -->
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success" role="alert">
                            <i class="bi bi-check-circle-fill me-2"></i>
                            @TempData["SuccessMessage"]
                        </div>
                    }

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            @TempData["ErrorMessage"]
                        </div>
                    }

                    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                    <!-- Login Form -->
                    <form method="post" class="auth-form">
                        <div class="form-group mb-3">
                            <label asp-for="LoginDto.UsernameOrEmail" class="form-label">
                                Email or Username
                            </label>
                            <div class="input-with-icon">
                                <i class="bi bi-person input-icon"></i>
                                <input asp-for="LoginDto.UsernameOrEmail" 
                                       type="text"
                                       class="form-control" 
                                       placeholder="Enter your email or username"
                                       autocomplete="username" />
                            </div>
                            <span asp-validation-for="LoginDto.UsernameOrEmail" class="text-danger small"></span>
                        </div>
                        
                        <div class="form-group mb-4">
                            <label asp-for="LoginDto.Password" class="form-label">Password</label>
                            <div class="input-with-icon">
                                <i class="bi bi-lock input-icon"></i>
                                <input asp-for="LoginDto.Password" 
                                       type="password" 
                                       class="form-control" 
                                       placeholder="Enter your password"
                                       autocomplete="current-password"
                                       id="password-input" />
                                <button type="button" 
                                        class="password-toggle"
                                        id="toggle-password">
                                    <i class="bi bi-eye" id="password-icon"></i>
                                </button>
                            </div>
                            <span asp-validation-for="LoginDto.Password" class="text-danger small"></span>
                        </div>

                        <div class="form-options mb-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="rememberMe" name="rememberMe" />
                                <label class="form-check-label" for="rememberMe">
                                    Remember me
                                </label>
                            </div>
                            <a href="#" class="forgot-password" data-bs-toggle="modal" data-bs-target="#forgotPasswordModal">
                                Forgot password?
                            </a>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100 mb-4" id="login-btn">
                            Sign In
                        </button>
                    </form>

                    <!-- Divider -->
                    <div class="divider">
                        <span>or</span>
                    </div>

                    <!-- Social Login -->
                    <div class="social-login">
                        <button type="button" class="btn btn-social btn-google mb-2">
                            <svg width="18" height="18" viewBox="0 0 18 18" class="me-2">
                                <path fill="#4285F4" d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 0 0 2.38-5.88c0-.57-.05-.66-.15-1.18Z"/>
                                <path fill="#34A853" d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2.04a4.8 4.8 0 0 1-7.18-2.53H1.83v2.07A8 8 0 0 0 8.98 17Z"/>
                                <path fill="#FBBC05" d="M4.5 10.49a4.8 4.8 0 0 1 0-3.07V5.35H1.83a8 8 0 0 0 0 7.28l2.67-2.14Z"/>
                                <path fill="#EA4335" d="M8.98 4.72c1.16 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 0 0 1.83 5.35L4.5 7.42a4.77 4.77 0 0 1 4.48-2.7Z"/>
                            </svg>
                            Continue with Google
                        </button>
                        
                        <button type="button" class="btn btn-social btn-github">
                            <i class="bi bi-github me-2"></i>
                            Continue with GitHub
                        </button>
                    </div>

                    <!-- Footer -->
                    <div class="auth-footer text-center">
                        <p class="mb-3">
                            New to LearnHub? 
                            <a asp-page="/User/Register" class="text-primary fw-semibold">Join for free</a>
                        </p>
                        <div class="auth-links">
                            <a asp-page="/Index" class="text-muted text-decoration-none me-3">
                                <i class="bi bi-house me-1"></i>Back to Home
                            </a>
                            <a href="#" class="text-muted text-decoration-none">Help</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Forgot Password Modal -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Reset your password</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted">Enter your email address and we'll send you a link to reset your password.</p>
                <div class="mb-3">
                    <label for="resetEmail" class="form-label">Email address</label>
                    <input type="email" class="form-control" id="resetEmail" placeholder="Enter your email">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Send Reset Link</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Password toggle
            const togglePassword = document.getElementById('toggle-password');
            const passwordInput = document.getElementById('password-input');
            const passwordIcon = document.getElementById('password-icon');

            if (togglePassword) {
                togglePassword.addEventListener('click', function() {
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    passwordIcon.className = type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
                });
            }

            // Form submission
            const loginForm = document.querySelector('.auth-form');
            const loginBtn = document.getElementById('login-btn');

            if (loginForm) {
                loginForm.addEventListener('submit', function() {
                    loginBtn.disabled = true;
                    loginBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Signing in...';
                });
            }
        });
    </script>
}
